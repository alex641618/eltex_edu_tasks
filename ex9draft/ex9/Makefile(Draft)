CC=gcc
LIB=../plugins
CFLAGS=-I../headers
LDFLAGS=-L.$(LIB) -lsumm -ldiff -lpro -lrat

#VPATH=../src ../headers ../obj ../plugins
vpath %.c ../src
vpath %.h ../headers
vpath %.o ../obj
vpath %.so ../plugins
my_kalc: my_kalc.c summ.c diff.c pro.c rat.c my_kalc.h *.so
	#gcc -fPIC summ.c diff.c pro.c rat.c -c
	$(CC) $(CFLAGS) my_kalc.c  $(LDFLAGS) -o $@
	mv ../$@ ../bin
	#cd ../bin
	#mv my_kalc bin
	#cd bin
	LD_LIBRARY_PATH=$(PWD)/.. bin/my_kalc
	#rm -rf ../obj/*.o ../plugins/*.so my_kalc
*.so: summ.o diff.o pro.o rat.o
	$(CC) -c -fPIC summ.c diff.c pro.c rat.c
	$(CC) -shared -o libsumm.so summ.o
	$(CC) -shared -o libdiff.so diff.o
	$(CC) -shared -o libpro.so pro.o
	$(CC) -shared -o librat.so rat.o
	mv *.o ../obj
	mv *.so ../plugins
clean:
	rm -rf ../obj/* ../bin/* ../plugins/*